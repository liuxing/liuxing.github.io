<!DOCTYPE html>
<html>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="Koa 是由 Express 原班人马打造的，致力于成为一个更小、更富有表现力、更健壮的 Web 框架，采用了async和await的方式执行异步操作。   Koa有v1.0与v2.0两个版本，随着node对async和await的支持，Koa2的正式发布，本文Koa均指Koa2 如果你还不熟悉async函数可查阅阮大的ECMAScript 6 入门 这是一篇从零开始的简易教程，话不多说，先来">
<meta property="og:type" content="article">
<meta property="og:title" content="Koa快速入门教程（一）">
<meta property="og:url" content="http://yoursite.com/2017/11/Koa/index.html">
<meta property="og:site_name" content="LIU XING">
<meta property="og:description" content="Koa 是由 Express 原班人马打造的，致力于成为一个更小、更富有表现力、更健壮的 Web 框架，采用了async和await的方式执行异步操作。   Koa有v1.0与v2.0两个版本，随着node对async和await的支持，Koa2的正式发布，本文Koa均指Koa2 如果你还不熟悉async函数可查阅阮大的ECMAScript 6 入门 这是一篇从零开始的简易教程，话不多说，先来">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://i.loli.net/2018/09/26/5bab3f21e1e18.png">
<meta property="og:image" content="https://i.loli.net/2018/09/26/5bab402b48798.png">
<meta property="og:image" content="https://i.loli.net/2018/09/26/5bab3f21c6fd2.png">
<meta property="og:image" content="http://yoursite.com/2017/11/Koa/koa2.png">
<meta property="og:updated_time" content="2018-09-26T08:16:20.293Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Koa快速入门教程（一）">
<meta name="twitter:description" content="Koa 是由 Express 原班人马打造的，致力于成为一个更小、更富有表现力、更健壮的 Web 框架，采用了async和await的方式执行异步操作。   Koa有v1.0与v2.0两个版本，随着node对async和await的支持，Koa2的正式发布，本文Koa均指Koa2 如果你还不熟悉async函数可查阅阮大的ECMAScript 6 入门 这是一篇从零开始的简易教程，话不多说，先来">
<meta name="twitter:image" content="https://i.loli.net/2018/09/26/5bab3f21e1e18.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
        
    
    <!-- title -->
    <title>Koa快速入门教程（一）</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="http://github.com/liuxing">Projects</a></li>
         
          <li><a href="/one-more-thing/">One more thing</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2017/11/sticky-footer/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2017/10/search-skills/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2017/11/Koa/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2017/11/Koa/&text=Koa快速入门教程（一）"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2017/11/Koa/&title=Koa快速入门教程（一）"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2017/11/Koa/&is_video=false&description=Koa快速入门教程（一）"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Koa快速入门教程（一）&body=Check out this article: http://yoursite.com/2017/11/Koa/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/2017/11/Koa/&title=Koa快速入门教程（一）"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/2017/11/Koa/&title=Koa快速入门教程（一）"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2017/11/Koa/&title=Koa快速入门教程（一）"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/2017/11/Koa/&title=Koa快速入门教程（一）"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2017/11/Koa/&name=Koa快速入门教程（一）&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#一、快速开始"><span class="toc-number">1.</span> <span class="toc-text">一、快速开始</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-开发环境"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 开发环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-必修的-hello-world-应用"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 必修的 hello world 应用:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-Context-对象"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 Context 对象</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二、路由-URL处理"><span class="toc-number">2.</span> <span class="toc-text">二、路由(URL处理)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-手动实现简易路由"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 手动实现简易路由</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-使用koa-router中间件"><span class="toc-number">3.</span> <span class="toc-text">2.2 使用koa-router中间件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#三、中间件"><span class="toc-number">4.</span> <span class="toc-text">三、中间件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#四、模板引擎"><span class="toc-number">5.</span> <span class="toc-text">四、模板引擎</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#五、静态资源服务器"><span class="toc-number">6.</span> <span class="toc-text">五、静态资源服务器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#六、请求数据的获取"><span class="toc-number">7.</span> <span class="toc-text">六、请求数据的获取</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-GET请求参数的获取"><span class="toc-number">7.1.</span> <span class="toc-text">6.1 GET请求参数的获取</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-POST请求数据获取"><span class="toc-number">7.2.</span> <span class="toc-text">6.2 POST请求数据获取</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考链接"><span class="toc-number">8.</span> <span class="toc-text">参考链接</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Koa快速入门教程（一）
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">LIU XING</span>
      </span>
      
    <div class="postdate">
        <time datetime="2017-11-17T16:00:00.000Z" itemprop="datePublished">2017-11-18</time>
    </div>


      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p><img src="https://i.loli.net/2018/09/26/5bab3f21e1e18.png" alt="koa2"></p>
<blockquote>
<p><a href="https://koa.bootcss.com/#introduction" target="_blank" rel="noopener">Koa</a> 是由 <a href="http://www.expressjs.com.cn/" target="_blank" rel="noopener">Express</a> 原班人马打造的，致力于成为一个更小、更富有表现力、更健壮的 Web 框架，采用了<code>async</code>和<code>await</code>的方式执行异步操作。 </p>
</blockquote>
<p><em>Koa有v1.0与v2.0两个版本，随着node对<code>async</code>和<code>await</code>的支持，Koa2的正式发布，本文Koa均指Koa2</em></p>
<p>如果你还不熟悉<code>async</code>函数可查阅阮大的<a href="http://es6.ruanyifeng.com/#docs/async" target="_blank" rel="noopener">ECMAScript 6 入门</a></p>
<p>这是一篇从零开始的简易教程，话不多说，先来快速开始：hello world！</p>
<h2 id="一、快速开始"><a href="#一、快速开始" class="headerlink" title="一、快速开始"></a>一、快速开始</h2><h3 id="1-1-开发环境"><a href="#1-1-开发环境" class="headerlink" title="1.1 开发环境"></a>1.1 开发环境</h3><p>Koa 依赖 <strong>node v7.6.0</strong> 或 ES2015及更高版本和 async 方法支持，你可以使用自己喜欢的版本管理器快速安装支持的 node 版本</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ node -v</span><br><span class="line">v8.9.1</span><br></pre></td></tr></table></figure>
<p>如果你的版本号小于v7.6.0,请自行升级。如使用<a href="https://github.com/creationix/nvm" target="_blank" rel="noopener">nvm</a></p>
<p>在确认好环境后，我们就可以新建一个项目，在里面自由操练了</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ mkdir KoaTutorial &amp;&amp; <span class="built_in">cd</span> KoaTutorial</span><br><span class="line"></span><br><span class="line">$ npm i koa --save</span><br></pre></td></tr></table></figure>
<h3 id="1-2-必修的-hello-world-应用"><a href="#1-2-必修的-hello-world-应用" class="headerlink" title="1.2 必修的 hello world 应用:"></a>1.2 必修的 hello world 应用:</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">'koa'</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"></span><br><span class="line">app.use(<span class="keyword">async</span> ctx =&gt; &#123;</span><br><span class="line">  ctx.body = <span class="string">'Hello World'</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>
<p>打开浏览器，访问 <a href="http://localhost:3000/" target="_blank" rel="noopener">http://localhost:3000/</a>，你会看到那可爱的<code>Hello World</code>。就是这么简单的几行代码，我们就起了一个HTTP服务，</p>
<p>来来看看这个hello world程序，其中前两行和后一行是架设一个 HTTP 服务。中间的则是对用户访问的处理。<code>ctx</code>则是Koa所提供的<code>Context</code>对象(上下文)，<code>ctx.body=</code>则是<code>ctx.response.body=</code>的alias(别名)，这是响应体设置的API。</p>
<h3 id="1-3-Context-对象"><a href="#1-3-Context-对象" class="headerlink" title="1.3 Context 对象"></a>1.3 Context 对象</h3><p>Koa Context 将 node 的 <code>request</code> 和 <code>response</code> 对象封装到单个对象中，为编写 Web 应用程序和 API 提供了许多有用的方法。上例的<code>ctx.body = &#39;&#39;</code>即是发送给用户内容，它是<code>ctx.response.body</code>的简写<em>(更多请查阅<a href="https://koa.bootcss.com" target="_blank" rel="noopener">官网</a>)</em>。<code>ctx.response</code>代表 HTTP Response。<code>ctx.request</code>代表 HTTP Request。</p>
<h2 id="二、路由-URL处理"><a href="#二、路由-URL处理" class="headerlink" title="二、路由(URL处理)"></a>二、路由(URL处理)</h2><h3 id="2-1-手动实现简易路由"><a href="#2-1-手动实现简易路由" class="headerlink" title="2.1 手动实现简易路由"></a>2.1 手动实现简易路由</h3><p>koa是个极简的web框架，简单到连路由模块都没有配备，我们先来可以根据<code>ctx.request.url</code>或者<code>ctx.request.path</code>获取用户请求的路径，来实现简单的路由。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">'koa'</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"></span><br><span class="line">app.use(<span class="keyword">async</span> ctx =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> _html = <span class="string">'404 NotFound'</span></span><br><span class="line">  <span class="keyword">switch</span> (ctx.url) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'/'</span>:</span><br><span class="line">      _html = <span class="string">'&lt;h1&gt;Index&lt;/h1&gt;'</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'/adout'</span>:</span><br><span class="line">      _html = <span class="string">'&lt;h1&gt;About&lt;/h1&gt;'</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'/hello'</span>:</span><br><span class="line">      _html = <span class="string">'&lt;h1&gt;world&lt;/h1&gt;'</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  ctx.body = _html;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>
<p>运行这段代码，访问<a href="http://localhost:3000/hello将看见world，访问http://localhost:3000/about将看见返回about，访问http://localhost:3000将看见Index。是不是很有成就感…但是这也太麻烦了吧。如果依靠`ctx.request.url`去手动处理路由，将会写很多代码，这时候就需要对应的路由中间件来对路由进行控制" target="_blank" rel="noopener">http://localhost:3000/hello将看见world，访问http://localhost:3000/about将看见返回about，访问http://localhost:3000将看见Index。是不是很有成就感…但是这也太麻烦了吧。如果依靠`ctx.request.url`去手动处理路由，将会写很多代码，这时候就需要对应的路由中间件来对路由进行控制</a>: <a href="https://github.com/alexmingoia/koa-router" target="_blank" rel="noopener">koa-router</a> </p>
<h2 id="2-2-使用koa-router中间件"><a href="#2-2-使用koa-router中间件" class="headerlink" title="2.2 使用koa-router中间件"></a>2.2 使用koa-router中间件</h2><p>下载并引入koa-router</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm i koa-router --save</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">'koa'</span>);</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">'koa-router'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router();</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">'/'</span>, <span class="keyword">async</span> (ctx) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> html = <span class="string">`</span></span><br><span class="line"><span class="string">      &lt;ul&gt;</span></span><br><span class="line"><span class="string">        &lt;li&gt;&lt;a href="/hello"&gt;helloworld&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li&gt;&lt;a href="/about"&gt;about&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">      &lt;/ul&gt;</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">  ctx.body = html</span><br><span class="line">&#125;).get(<span class="string">'/hello'</span>, <span class="keyword">async</span> (ctx) =&gt; &#123;</span><br><span class="line">  ctx.body = <span class="string">'helloworld'</span></span><br><span class="line">&#125;).get(<span class="string">'/about'</span>, <span class="keyword">async</span> (ctx) =&gt; &#123;</span><br><span class="line">  ctx.body = <span class="string">'about'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.use(router.routes(), router.allowedMethods())</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>
<p>运行这个 demo，我们将看到与上栗一样的效果。在这儿我们使用到了第三方中间件。</p>
<h2 id="三、中间件"><a href="#三、中间件" class="headerlink" title="三、中间件"></a>三、中间件</h2><p>Koa 的最大特色，也是最重要的一个设计，就是中间件（middleware）Koa 应用程序是一个包含一组中间件函数的对象，它是按照类似堆栈的方式组织和执行的。Koa中使用<code>app.use()</code>用来加载中间件，基本上Koa 所有的功能都是通过中间件实现的。每个中间件默认接受两个参数，第一个参数是 Context 对象，第二个参数是<code>next</code>函数。只要调用<code>next</code>函数，就可以把执行权转交给下一个中间件。</p>
<p>下图为经典的Koa洋葱模型</p>
<p><img src="https://i.loli.net/2018/09/26/5bab402b48798.png" alt="koa2洋葱模型"><br>我们来运行Koa官网这个小例子：<br><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">'koa'</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"></span><br><span class="line"><span class="comment">// x-response-time</span></span><br><span class="line"></span><br><span class="line">app.use(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> start = <span class="built_in">Date</span>.now();</span><br><span class="line">  <span class="keyword">await</span> next();</span><br><span class="line">  <span class="keyword">const</span> ms = <span class="built_in">Date</span>.now() - start;</span><br><span class="line">  ctx.set(<span class="string">'X-Response-Time'</span>, <span class="string">`<span class="subst">$&#123;ms&#125;</span>ms`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// logger</span></span><br><span class="line"></span><br><span class="line">app.use(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> start = <span class="built_in">Date</span>.now();</span><br><span class="line">  <span class="keyword">await</span> next();</span><br><span class="line">  <span class="keyword">const</span> ms = <span class="built_in">Date</span>.now() - start;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;ctx.method&#125;</span> <span class="subst">$&#123;ctx.url&#125;</span> - <span class="subst">$&#123;ms&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// response</span></span><br><span class="line"></span><br><span class="line">app.use(<span class="keyword">async</span> ctx =&gt; &#123;</span><br><span class="line">  ctx.body = <span class="string">'Hello World'</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure></p>
<p>上面的执行顺序就是：请求 ==&gt; x-response-time中间件 ==&gt; logger中间件 ==&gt; 响应中间件 ==&gt; logger中间件 ==&gt; response-time中间件 ==&gt; 响应。 通过这个顺序我们可以发现这是个栈结构以”先进后出”（first-in-last-out）的顺序执行。Koa已经有了很多好用的中间件<em>(<a href="https://github.com/koajs/koa/wiki#middleware" target="_blank" rel="noopener">https://github.com/koajs/koa/wiki#middleware</a>)你需要的常用功能基本上都有人实现了</em></p>
<h2 id="四、模板引擎"><a href="#四、模板引擎" class="headerlink" title="四、模板引擎"></a>四、模板引擎</h2><p>在实际开发中，返回给用户的网页往往都写成模板文件。 Koa 先读取模板文件，然后将这个模板返回给用户，这事我们就需要使用模板引擎了，关于Koa的模版引擎，我们只需要安装koa模板使用中间件<a href="https://github.com/queckezz/koa-views" target="_blank" rel="noopener">koa-views</a> 然后在下载你喜欢的模板引擎<em>(<a href="https://github.com/tj/consolidate.js#supported-template-engines" target="_blank" rel="noopener">支持列表</a>)</em>便可以愉快的使用了。如安装使用<a href="https://github.com/mde/ejs" target="_blank" rel="noopener">ejs</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 安装koa模板使用中间件</span></span><br><span class="line">$ npm i --save koa-views</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装ejs模板引擎</span></span><br><span class="line">$ npm i --save ejs</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">'koa'</span>)</span><br><span class="line"><span class="keyword">const</span> views = <span class="built_in">require</span>(<span class="string">'koa-views'</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载模板引擎</span></span><br><span class="line">app.use(views(path.join(__dirname, <span class="string">'./view'</span>), &#123;</span><br><span class="line">    extension: <span class="string">'ejs'</span></span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line">app.use(<span class="keyword">async</span> (ctx) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> title = <span class="string">'Koa2'</span></span><br><span class="line">    <span class="keyword">await</span> ctx.render(<span class="string">'index'</span>, &#123;</span><br><span class="line">        title,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure>
<p><code>./view/index.ejs</code> 模板<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;&lt;%= title %&gt;&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;&lt;%= title %&gt;&lt;/h1&gt;</span><br><span class="line">    &lt;p&gt;EJS Welcome to &lt;%= title %&gt;&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>
<p>打开<a href="http://localhost:3000/，你将看到返回了页面：" target="_blank" rel="noopener">http://localhost:3000/，你将看到返回了页面：</a></p>
<p><img src="https://i.loli.net/2018/09/26/5bab3f21c6fd2.png" alt="koa 模板引擎"><br>关于ejs语法请访问ejs官网学习：<a href="https://github.com/mde/ejs" target="_blank" rel="noopener">https://github.com/mde/ejs</a></p>
<h2 id="五、静态资源服务器"><a href="#五、静态资源服务器" class="headerlink" title="五、静态资源服务器"></a>五、静态资源服务器</h2><p>网站一般都提供静态资源（图片、字体、样式表、脚本……），我们可以自己实现一个静态资源服务器，但这没必要，<a href="https://www.npmjs.com/package/koa-static" target="_blank" rel="noopener">koa-static</a>模块封装了这部分功能。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ npm i --save koa-static</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">'koa'</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">static</span> = <span class="built_in">require</span>(<span class="string">'koa-static'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 静态资源目录对于相对入口文件index.js的路径</span></span><br><span class="line"><span class="keyword">const</span> staticPath = <span class="string">'./static'</span></span><br><span class="line"></span><br><span class="line">app.use(<span class="keyword">static</span>(</span><br><span class="line">  path.join(__dirname, staticPath)</span><br><span class="line">))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.use(<span class="keyword">async</span> (ctx) =&gt; &#123;</span><br><span class="line">  ctx.body = <span class="string">'hello world'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure>
<p>我们访问<a href="http://localhost:3000/css/app.css" target="_blank" rel="noopener">http://localhost:3000/css/app.css</a> 将返回<code>app.css</code> 的内容，访问<a href="http://localhost:3000/koa2.png我们将看见返回下图" target="_blank" rel="noopener">http://localhost:3000/koa2.png我们将看见返回下图</a></p>
<p><img src="./koa2.png" alt="koa2"></p>
<h2 id="六、请求数据的获取"><a href="#六、请求数据的获取" class="headerlink" title="六、请求数据的获取"></a>六、请求数据的获取</h2><p>前文我们主要都在处理数据的响应，这儿我们来了解下Koa获取请求数据，主要为<code>GET</code>和<code>POST</code>方式。</p>
<h3 id="6-1-GET请求参数的获取"><a href="#6-1-GET请求参数的获取" class="headerlink" title="6.1 GET请求参数的获取"></a>6.1 GET请求参数的获取</h3><p>在koa中，获取GET请求数据源头是koa中request对象中的query方法或querystring方法，query返回是格式化好的参数对象，querystring返回的是请求字符串。</p>
<ul>
<li>请求对象ctx.query<em>(或ctx.request.query)</em>，返回如 { a:1, b:2 }</li>
<li>请求字符串 ctx.querystring<em>(或ctx.request.querystring)</em>，返回如 a=1&amp;b=2</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">'koa'</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line"></span><br><span class="line">app.use( <span class="keyword">async</span> ( ctx ) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> url = ctx.url</span><br><span class="line">  <span class="keyword">const</span> query = ctx.query</span><br><span class="line">  <span class="keyword">const</span> querystring = ctx.querystring</span><br><span class="line"></span><br><span class="line">  ctx.body = &#123;</span><br><span class="line">    url,</span><br><span class="line">    query,</span><br><span class="line">    querystring</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure>
<p>运行程序并访问<a href="http://localhost:3000/?page=2&amp;limit=10，我们将得到如下结果" target="_blank" rel="noopener">http://localhost:3000/?page=2&amp;limit=10，我们将得到如下结果</a></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;<span class="attr">"url"</span>:<span class="string">"/?page=2&amp;limit=10"</span>,<span class="attr">"query"</span>:&#123;<span class="attr">"page"</span>:<span class="string">"2"</span>,<span class="attr">"limit"</span>:<span class="string">"10"</span>&#125;,<span class="attr">"querystring"</span>:<span class="string">"page=2&amp;limit=10"</span>&#125;</span><br></pre></td></tr></table></figure>
<p>对了，在这儿推荐个插件：<a href="https://github.com/gildas-lormeau/JSONView-for-Chrome" target="_blank" rel="noopener">JSONView</a>，用了它你将得到格式化json数据，如下：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  url: "/?page=2&amp;limit=10",</span><br><span class="line">  query: &#123;</span><br><span class="line">    page: "2",</span><br><span class="line">    limit: "10"</span><br><span class="line">  &#125;,</span><br><span class="line">  querystring: "page=2&amp;limit=10"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>更多Koa Request API 请查看<a href="http://koajs.com/#request" target="_blank" rel="noopener">http://koajs.com/#request</a></p>
<h3 id="6-2-POST请求数据获取"><a href="#6-2-POST请求数据获取" class="headerlink" title="6.2 POST请求数据获取"></a>6.2 POST请求数据获取</h3><p>对于POST请求的处理，koa2没有封装获取参数的方法，需要通过自己解析上下文context中的原生node.js请求对象req，将POST表单数据解析成querystring（例如：<code>a=1&amp;b=2&amp;c=3</code>），再将querystring 解析成JSON格式（例如：<code>{&quot;a&quot;:&quot;1&quot;, &quot;b&quot;:&quot;2&quot;, &quot;c&quot;:&quot;3&quot;}</code>），我们来直接使用<a href="https://github.com/koajs/bodyparser" target="_blank" rel="noopener">koa-bodyparser</a> 模块从 POST 请求的数据体里面提取键值对。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">'koa'</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">'koa-bodyparser'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用koa-bodyparser中间件</span></span><br><span class="line">app.use(bodyParser())</span><br><span class="line"></span><br><span class="line">app.use(<span class="keyword">async</span> (ctx) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (ctx.url === <span class="string">'/'</span> &amp;&amp; ctx.method === <span class="string">'GET'</span>) &#123;</span><br><span class="line">    <span class="comment">// 当GET请求时候返回表单页面</span></span><br><span class="line">    <span class="keyword">let</span> html = <span class="string">`</span></span><br><span class="line"><span class="string">      &lt;h1&gt;koa-bodyparser&lt;/h1&gt;</span></span><br><span class="line"><span class="string">      &lt;form method="POST" action="/"&gt;</span></span><br><span class="line"><span class="string">        Name:&lt;input name="name" /&gt;&lt;br/&gt;</span></span><br><span class="line"><span class="string">        Age:&lt;input name="age" /&gt;&lt;br/&gt;</span></span><br><span class="line"><span class="string">        Email: &lt;input name="email" /&gt;&lt;br/&gt;</span></span><br><span class="line"><span class="string">        &lt;button type="submit"&gt;submit&lt;/button&gt;</span></span><br><span class="line"><span class="string">      &lt;/form&gt;</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">    ctx.body = html</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ctx.url === <span class="string">'/'</span> &amp;&amp; ctx.method === <span class="string">'POST'</span>) &#123;</span><br><span class="line">    <span class="comment">// 当POST请求的时候，中间件koa-bodyparser解析POST表单里的数据，并显示出来</span></span><br><span class="line">    ctx.body = ctx.request.body</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 404</span></span><br><span class="line">    ctx.body = <span class="string">'&lt;h1&gt;404 Not Found&lt;/h1&gt;'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure>
<p>运行程序，填写并提交表单，请求结果为：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  name: "ogilhinn",</span><br><span class="line">  age: "120",</span><br><span class="line">  email: "ogilhinn@gmail.com"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>关于更多的Koa知识快打开搜索引擎搜索<em>()</em>继续学习吧，后续将继续数据库的操作以及实现一个简单的小案例。</p>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ul>
<li><a href="https://koa.bootcss.com" target="_blank" rel="noopener">Koa官网</a></li>
<li><a href="https://chenshenhai.github.io/koa2-note/" target="_blank" rel="noopener">Koa进阶学习笔记</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2017/08/koa.html" target="_blank" rel="noopener">Koa 框架教程</a></li>
<li><a href="https://github.com/koajs/koa/wiki" target="_blank" rel="noopener">Koa wiki</a></li>
</ul>

  </div>
</article>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="http://github.com/liuxing">Projects</a></li>
         
          <li><a href="/one-more-thing/">One more thing</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#一、快速开始"><span class="toc-number">1.</span> <span class="toc-text">一、快速开始</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-开发环境"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 开发环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-必修的-hello-world-应用"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 必修的 hello world 应用:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-Context-对象"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 Context 对象</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二、路由-URL处理"><span class="toc-number">2.</span> <span class="toc-text">二、路由(URL处理)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-手动实现简易路由"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 手动实现简易路由</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-使用koa-router中间件"><span class="toc-number">3.</span> <span class="toc-text">2.2 使用koa-router中间件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#三、中间件"><span class="toc-number">4.</span> <span class="toc-text">三、中间件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#四、模板引擎"><span class="toc-number">5.</span> <span class="toc-text">四、模板引擎</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#五、静态资源服务器"><span class="toc-number">6.</span> <span class="toc-text">五、静态资源服务器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#六、请求数据的获取"><span class="toc-number">7.</span> <span class="toc-text">六、请求数据的获取</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-GET请求参数的获取"><span class="toc-number">7.1.</span> <span class="toc-text">6.1 GET请求参数的获取</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-POST请求数据获取"><span class="toc-number">7.2.</span> <span class="toc-text">6.2 POST请求数据获取</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考链接"><span class="toc-number">8.</span> <span class="toc-text">参考链接</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2017/11/Koa/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2017/11/Koa/&text=Koa快速入门教程（一）"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2017/11/Koa/&title=Koa快速入门教程（一）"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2017/11/Koa/&is_video=false&description=Koa快速入门教程（一）"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Koa快速入门教程（一）&body=Check out this article: http://yoursite.com/2017/11/Koa/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/2017/11/Koa/&title=Koa快速入门教程（一）"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/2017/11/Koa/&title=Koa快速入门教程（一）"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2017/11/Koa/&title=Koa快速入门教程（一）"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/2017/11/Koa/&title=Koa快速入门教程（一）"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2017/11/Koa/&name=Koa快速入门教程（一）&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2018 Liu Xing
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="http://github.com/liuxing">Projects</a></li>
         
          <li><a href="/one-more-thing/">One more thing</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


